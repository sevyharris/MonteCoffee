

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>NeighborKMC.base.kmc &mdash; MonteCoffee  documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> MonteCoffee
          

          
            
            <img src="../../../_static/avatar.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../overview.html">Code overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quick.html">Quick start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../output.html">Code output</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../options.html">Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/index.html">User interface (API)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cite.html">How to cite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../literature.html">Additional reading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">MonteCoffee</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>NeighborKMC.base.kmc</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for NeighborKMC.base.kmc</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Defines the NeighborKMCBase class.</span>

<span class="sd">The methods are used to perform kMC </span>
<span class="sd">simulations with the first reaction method.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="kn">import</span> <span class="n">configparser</span>
<span class="kn">import</span> <span class="nn">six</span>

<span class="k">if</span> <span class="n">six</span><span class="o">.</span><span class="n">PY2</span><span class="p">:</span>
    <span class="n">ConfigParser</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">SafeConfigParser</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">ConfigParser</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">()</span>
<span class="c1">#from base.basin import superbasin, leave_superbasin, rescaling, scaling_rs, scaling_ks</span>

<div class="viewcode-block" id="NeighborKMCBase"><a class="viewcode-back" href="../../../api/NeighborKMC.base.html#NeighborKMC.base.kmc.NeighborKMCBase">[docs]</a><span class="k">class</span> <span class="nc">NeighborKMCBase</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Main class for performing MonteCoffee simulations.</span>
<span class="sd">          </span>
<span class="sd">    Assigns a system to the simulation, stores parameters, </span>
<span class="sd">    and reads in software configuration from the separate  </span>
<span class="sd">    file kMC_options.cfg.  </span>
<span class="sd">    Then it sets the time equal to zero and prepares to perform</span>
<span class="sd">    frm kinetic Monte Carlo simulations.</span>

<span class="sd">    Attributes</span>
<span class="sd">    -----------</span>
<span class="sd">    system: System</span>
<span class="sd">        The system instance to perform the simulation on.</span>

<span class="sd">    tend: float</span>
<span class="sd">        Simulation end-time, given in seconds.</span>

<span class="sd">    parameters: dict</span>
<span class="sd">        parameters used to calculate rate-constants and to dump to log files.</span>
<span class="sd">        Example: parameters = {&#39;pCO&#39;:1E2,&#39;T&#39;:700,&#39;Note&#39;:&#39;Test simulation&#39;}</span>

<span class="sd">    t: float</span>
<span class="sd">        Current simulation time in seconds.</span>

<span class="sd">    *Attributes used to keep track of events (where and when they happen)*</span>

<span class="sd">    siteslist: list(int)</span>
<span class="sd">        The list of sites for each specific event.</span>
<span class="sd">        This list has the length: len(self.events)*len(self.sites)*len(self.sites).</span>

<span class="sd">    other_sitelist: list(int)</span>
<span class="sd">        The list of neighbor sites for each specific event.</span>
<span class="sd">        This list has the length: len(self.events)*len(self.sites)*len(self.sites).</span>

<span class="sd">    lastsel: int</span>
<span class="sd">        The int of the last selected site.</span>

<span class="sd">    lastother: int</span>
<span class="sd">        The int of the last selected neighbor site.</span>

<span class="sd">    rindex: list(list(list(int)))):</span>
<span class="sd">        The index of the specific events in lists like self.frm_times. For example to find the indices</span>
<span class="sd">        of site no i and event no j and neighbor number k to site i, call</span>
<span class="sd">        rindex[i][j][k].</span>

<span class="sd">    possible_evs: list(int):</span>
<span class="sd">        List of events that are possible, used for superbasin algorithms.</span>
<span class="sd">        This list has the length: len(self.events)*len(self.sites)*len(self.sites).</span>

<span class="sd">    evs: numpy.ndarray(int):</span>
<span class="sd">        The event numbers for each specific event.</span>
<span class="sd">        This list has the length: len(self.events)*len(self.sites)*len(self.sites).</span>

<span class="sd">    rs: numpy.ndarray(float)</span>
<span class="sd">        Rate constants of specific events.</span>
<span class="sd">        This list has the length: len(self.events)*len(self.sites)*len(self.sites).</span>

<span class="sd">    wheres: list(list(int)):</span>
<span class="sd">        List of all the positions of the event-types in the lists with length</span>
<span class="sd">        len(self.events)*len(self.sites)*len(self.sites). To find all site-indices where event i</span>
<span class="sd">        happens, call wheres[i].</span>
<span class="sd">  </span>
<span class="sd">    involve_other: bool:</span>
<span class="sd">        -False if the event happens only on one specific site</span>
<span class="sd">        -True if the event modifies two or more sites         </span>


<span class="sd">    *Statistics counting attributes used to log and write output*</span>

<span class="sd">    SaveSteps: int</span>
<span class="sd">        The number of Monte Carlo steps between saving the .txt files.</span>

<span class="sd">    LogSteps: int</span>
<span class="sd">        The number of Monte Carlo steps between logging steps.</span>

<span class="sd">    tinfinity: float</span>
<span class="sd">        What time to put impossible events to.</span>

<span class="sd">    nninter: int</span>
<span class="sd">        The extent of the adsorbate-adsorbate interactions, given as the number</span>
<span class="sd">        of nearest-neighbor interactions.</span>

<span class="sd">    Nspecies: int</span>
<span class="sd">        How many different types of species are in the simulation. Used to</span>
<span class="sd">        print and log.</span>

<span class="sd">    verbose: bool</span>
<span class="sd">        If True, the code prints verbose information.</span>

<span class="sd">    save_coverages: bool</span>
<span class="sd">        If True, coverages are saved to coverages.txt. This can result in</span>
<span class="sd">        large files.</span>

<span class="sd">    write_atoms: bool</span>
<span class="sd">        If True, the surface atoms are written with the step number in the filename. It has to be adjusted for adsorption species individually. </span>

<span class="sd">    times: list(float)</span>
<span class="sd">        List of times for each logged monte carlo steps in self.MCstep</span>

<span class="sd">    MCstep: list(int)</span>
<span class="sd">        List of Monte Carlo step numbers logged.</span>

<span class="sd">    Nsites: int</span>
<span class="sd">        The number of sites in self.system</span>

<span class="sd">    Nstypes: int</span>
<span class="sd">        The number of distinct site-types.</span>

<span class="sd">    covered: list(list(int))</span>
<span class="sd">        A list of site-occupations, of each site for each logged step.</span>
<span class="sd">        To find the site-occupation at step no self.MCstep[i] and site j, call</span>
<span class="sd">        covered[i][j].</span>

<span class="sd">    stype_ev: dict(list(int))</span>
<span class="sd">        How many events are fired of each type (values) for each site type (keys).</span>

<span class="sd">    stype_ev_other: dict(list(int))</span>
<span class="sd">        How many events are fired for neighbor sites of each type (values) for each site type (keys).</span>

<span class="sd">    sid_ev: dict(list(int))</span>
<span class="sd">        How many events are fired of each type for each site-index. To find the number event j fired</span>
<span class="sd">        on site number i, call sid_ev[i][j].</span>

<span class="sd">    sid_ev_other: dict(list(int))</span>
<span class="sd">        How many events are fired of each type for each other-site-index. To find the number event j fired</span>
<span class="sd">        on site number i, call sid_ev[i][j].</span>

<span class="sd">    used_ijk: list(tuples(site,event,othersite))</span>
<span class="sd">        List of tuples representing the unique neighbor-event pairs avoiding double counting. </span>

<span class="sd">    *Superbasin attributes related to temporal acceleration*</span>

<span class="sd">    equilEV: list(int)</span>
<span class="sd">        A list of the event-indices that are quasi-equilibrated.</span>

<span class="sd">    scaling_func: function</span>
<span class="sd">        Reference to a function to compute the superbasin-escape rate.</span>

<span class="sd">    tgen: list(float)</span>
<span class="sd">        A list of when each specific event was generated.</span>
<span class="sd">        This list has the length: len(self.events)*len(self.sites)*len(self.sites).</span>

<span class="sd">    us: list(float)</span>
<span class="sd">        A list of random deviates used when each specific event was generated.</span>
<span class="sd">        This list has the length: len(self.events)*len(self.sites)*len(self.sites).</span>

<span class="sd">    ks: list(float)</span>
<span class="sd">        A list of rate-constants obtained when each specific event was generated.</span>
<span class="sd">        This list has the length: len(self.events)*len(self.sites)*len(self.sites).</span>

<span class="sd">    r_S: numpy.ndarray(float)</span>
<span class="sd">        The cumulative rates in the current superbasin.</span>

<span class="sd">    dt_S: list(float)</span>
<span class="sd">        The time-steps taken in the current superbasin.</span>

<span class="sd">    nem: numpy.ndarray(int)</span>
<span class="sd">        The number of times an event was performed the last self.ne steps</span>

<span class="sd">    Nm: list(numpy.ndarray(int))</span>

<span class="sd">    delta: float</span>
<span class="sd">        Reversibility tolerance to determine if reactions have become quasi-equilibrated.</span>

<span class="sd">    Nf: int</span>
<span class="sd">        The average number of steps a quasi-equilibrated event should be observed in each superbasin.</span>
<span class="sd">        When self.usekavg == True, this simply means that a low Nf is more aggressive scaling.</span>

<span class="sd">    Ns: int</span>
<span class="sd">        The frequency of barrier scaling.</span>

<span class="sd">    ne: int</span>
<span class="sd">        The minimum number of times to see a quasi-equilibrated event in each superbasin.</span>

<span class="sd">    usekavg: bool</span>
<span class="sd">        Use average rate-constants to scale the rate-constants as opposed</span>
<span class="sd">        to rates.</span>

<span class="sd">    ksavg: list(float):</span>
<span class="sd">        The average rate-constant for each event type.</span>

<span class="sd">    Suffex: list(int)</span>
<span class="sd">        List of sufficiently executed events.</span>

<span class="sd">    isup: int</span>
<span class="sd">        How many steps were taken in the current superbasin.</span>

<span class="sd">    pm: int</span>
<span class="sd">        Step floor divisor to determine position in self.nem.</span>


<span class="sd">    See Also</span>
<span class="sd">    ---------</span>
<span class="sd">    Module: user_kmc</span>
<span class="sd">    Module: base.basin</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">tend</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="p">{}):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">system</span> <span class="o">=</span> <span class="n">system</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tend</span> <span class="o">=</span> <span class="n">tend</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="mf">0.</span>  <span class="c1">#Initialize the time</span>

        <span class="c1"># Load software configuration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_options</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;MonteCoffee Simulation Initialized&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;kMC simulation loading ...&#39;</span><span class="p">)</span>

        <span class="c1"># Variables connected to after analysis.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">times</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Times of simulation point</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MCstep</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Number of MCSteps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">covered</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Site-occupations</span>

        <span class="c1"># Initialize event book keeping variables</span>
        <span class="n">evnl</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stype_ev</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stype_ev_other</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sid_ev</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">sites</span><span class="p">))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sid_ev_other</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">sites</span><span class="p">))]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Nstypes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">stype</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">sites</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nstypes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stype_ev</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">evnl</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stype_ev_other</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">evnl</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">used_ijk</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># Avoid double counting events of site 1+2 vs site 2+1.</span>

        <span class="c1"># FRM method variables</span>
        <span class="c1"># --------------------------------------------------     </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frm_times</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Times of occourences</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frm_arg</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># args that sort frm times</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Initializing First Reaction method lists ...&#39;</span><span class="p">)</span>
            <span class="n">scalestr</span> <span class="o">=</span> <span class="s2">&quot;Scaling based on rate constants ...&quot;</span> <span class="k">if</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">usekavg</span> <span class="k">else</span> <span class="s2">&quot;Scaling based on rates ...&quot;</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">scalestr</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frm_init</span><span class="p">()</span>

<div class="viewcode-block" id="NeighborKMCBase.load_options"><a class="viewcode-back" href="../../../api/NeighborKMC.base.html#NeighborKMC.base.kmc.NeighborKMCBase.load_options">[docs]</a>    <span class="k">def</span> <span class="nf">load_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Loads all options set in kMC_options.cfg.</span>
<span class="sd">        </span>
<span class="sd">        Instantiates a configuration parser, and loads in all</span>
<span class="sd">        options from *kMC_options.cfg*.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">RawConfigParser</span><span class="p">()</span>
        <span class="n">config</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;kMC_options.cfg&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SaveSteps</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">getint</span><span class="p">(</span><span class="s1">&#39;Parameters&#39;</span><span class="p">,</span> <span class="s1">&#39;SaveSteps&#39;</span><span class="p">)</span>  <span class="c1"># How often to save txt files</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LogSteps</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">getint</span><span class="p">(</span><span class="s1">&#39;Parameters&#39;</span><span class="p">,</span> <span class="s1">&#39;LogSteps&#39;</span><span class="p">)</span>  <span class="c1"># How often to log steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tinfinity</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">getfloat</span><span class="p">(</span><span class="s1">&#39;Parameters&#39;</span><span class="p">,</span> <span class="s1">&#39;tinfinity&#39;</span><span class="p">)</span>  <span class="c1"># What is considered infinite time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nninter</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">getint</span><span class="p">(</span><span class="s1">&#39;Parameters&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;nninteractions&#39;</span><span class="p">)</span>  <span class="c1"># Range of ads-ads interactions (affects local update).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nspecies</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">getint</span><span class="p">(</span><span class="s1">&#39;Parameters&#39;</span><span class="p">,</span> <span class="s1">&#39;Nspecies&#39;</span><span class="p">)</span>  <span class="c1"># Number of different species in simulation.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">getboolean</span><span class="p">(</span><span class="s1">&#39;Options&#39;</span><span class="p">,</span> <span class="s1">&#39;Verbose&#39;</span><span class="p">)</span>  <span class="c1"># Print verbose information?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_atoms</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">getboolean</span><span class="p">(</span><span class="s1">&#39;Options&#39;</span><span class="p">,</span> <span class="s1">&#39;Write_atoms&#39;</span><span class="p">)</span>  <span class="c1"># Print verbose information?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_coverages</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">getboolean</span><span class="p">(</span><span class="s1">&#39;Options&#39;</span><span class="p">,</span> <span class="s1">&#39;SaveCovs&#39;</span><span class="p">)</span>  <span class="c1"># Save coverages?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">getfloat</span><span class="p">(</span><span class="s1">&#39;Options&#39;</span><span class="p">,</span> <span class="s1">&#39;Delta&#39;</span><span class="p">)</span>  <span class="c1"># reversibility tolerance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nf</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">getfloat</span><span class="p">(</span><span class="s1">&#39;Options&#39;</span><span class="p">,</span> <span class="s1">&#39;Nf&#39;</span><span class="p">)</span>  <span class="c1"># Avg event observance in superbasins</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ns</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">getint</span><span class="p">(</span><span class="s1">&#39;Options&#39;</span><span class="p">,</span> <span class="s1">&#39;Ns&#39;</span><span class="p">)</span>  <span class="c1"># update the barriers every Ns step.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ne</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">getint</span><span class="p">(</span><span class="s1">&#39;Options&#39;</span><span class="p">,</span> <span class="s1">&#39;Ne&#39;</span><span class="p">)</span>  <span class="c1"># Nsteps for sufficient executed events.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">usekavg</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">getboolean</span><span class="p">(</span><span class="s1">&#39;Options&#39;</span><span class="p">,</span> <span class="s1">&#39;usekavg&#39;</span><span class="p">)</span>  <span class="c1"># Use rate-constants for scaling, not rates</span></div>

<div class="viewcode-block" id="NeighborKMCBase.frm_init"><a class="viewcode-back" href="../../../api/NeighborKMC.base.html#NeighborKMC.base.kmc.NeighborKMCBase.frm_init">[docs]</a>    <span class="k">def</span> <span class="nf">frm_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prepare to perform FRM simulation.</span>
<span class="sd">            </span>
<span class="sd">        Initializes empty rate and event lists to </span>
<span class="sd">        bookkeep the FRM algorithm. The initial times</span>
<span class="sd">        of occurrence for each event is also calculated</span>
<span class="sd">        and stored.  </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">siteslist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">other_sitelist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastsel</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastother</span> <span class="o">=</span> <span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">rindex</span> <span class="o">=</span> <span class="p">[[[]</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">))]</span> <span class="k">for</span> \
                       <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">sites</span><span class="p">))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">correct_index</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">possible_evs</span> <span class="o">=</span> <span class="p">[]</span> 
 
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">sites</span><span class="p">):</span>
            <span class="n">NNcur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">other_site</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">NNcur</span><span class="p">):</span>
                    <span class="n">used_ijk</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">other_site</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">used_ijk</span> <span class="ow">or</span> <span class="p">(</span><span class="n">other_site</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">used_ijk</span> <span class="k">else</span> <span class="kc">False</span> <span class="c1"># Check if the pair is already in list </span>
                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">possible</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">other_site</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">used_ijk</span><span class="p">:</span> 
                        <span class="n">rcur</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">get_rate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">other_site</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">frm_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">rcur</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">possible_evs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
		    
                    <span class="k">elif</span> <span class="ow">not</span> <span class="n">used_ijk</span><span class="p">:</span> <span class="c1"># Add only disabled events to the list for unique pairs</span>
                        <span class="n">rcur</span> <span class="o">=</span> <span class="mf">0.</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">frm_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tinfinity</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">possible_evs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

                    <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">other_site</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">used_ijk</span> <span class="ow">and</span> <span class="p">(</span><span class="n">other_site</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">used_ijk</span><span class="p">:</span> <span class="c1"># Create unique pair-event tuple list  </span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">used_ijk</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">other_site</span><span class="p">))</span> 
                        <span class="bp">self</span><span class="o">.</span><span class="n">correct_index</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">))</span> <span class="c1"># extra only for the initialization  </span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">rindex</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rs</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">evs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">rs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rcur</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">siteslist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">other_sitelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">other_site</span><span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span> <span class="c1"># Important to book-keep the rindex list and crossref to unique pair-event pairs</span>
                        <span class="n">ind_search</span> <span class="o">=</span> <span class="p">[</span><span class="n">si</span> <span class="k">for</span> <span class="n">si</span><span class="p">,</span> <span class="n">tupl</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">used_ijk</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">tupl</span> <span class="o">==</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">other_site</span><span class="p">)</span> <span class="ow">or</span> <span class="n">tupl</span> <span class="o">==</span> <span class="p">(</span><span class="n">other_site</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">))][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">use_tuble</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">correct_index</span><span class="p">[</span><span class="n">ind_search</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">rindex</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rindex</span><span class="p">[</span><span class="n">use_tuble</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">use_tuble</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">use_tuble</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
                    
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">e</span><span class="o">.</span><span class="n">get_involve_other</span><span class="p">():</span> <span class="c1">#Ensure that events which doesn&#39;t involve neighbors do not produce aditional times</span>
                        <span class="k">break</span>            

        <span class="bp">self</span><span class="o">.</span><span class="n">frm_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frm_times</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frm_arg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frm_times</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span></div>

<div class="viewcode-block" id="NeighborKMCBase.frm_update"><a class="viewcode-back" href="../../../api/NeighborKMC.base.html#NeighborKMC.base.kmc.NeighborKMCBase.frm_update">[docs]</a>    <span class="k">def</span> <span class="nf">frm_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Updates the FRM related lists.</span>
<span class="sd">            </span>
<span class="sd">        Method updates the event list locally  </span>
<span class="sd">        around the site where the last event happened. This is done</span>
<span class="sd">        by determining if new events have become possible as a result of</span>
<span class="sd">        performing the last event.</span>

<span class="sd">        Events that are no longer possible because of executring the previous</span>
<span class="sd">        event are flagged as impossibe and their time is set to infinity.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Find site indices to update:</span>
        <span class="n">search</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">find_nn_recurse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">lastsel</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">lastother</span><span class="p">])</span>

        <span class="c1"># Save reference to function calls to reduce overhead</span>
        <span class="n">get_r_func</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">get_rate</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">]</span>
        <span class="n">possible_func</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">possible</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">search</span><span class="p">:</span>
            <span class="c1"># Determine if any events have become possible.</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">other</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">neighbors</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                    <span class="n">used_ijk</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">used_ijk</span> <span class="k">else</span> <span class="kc">False</span> 
                    <span class="k">if</span> <span class="n">used_ijk</span><span class="p">:</span>
                        <span class="n">poslist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rindex</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
                        <span class="n">poss_now</span> <span class="o">=</span> <span class="n">possible_func</span><span class="p">[</span><span class="n">j</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">poss_now</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">possible_evs</span><span class="p">[</span><span class="n">poslist</span><span class="p">]:</span> 
                            <span class="n">rcur</span> <span class="o">=</span> <span class="n">get_r_func</span><span class="p">[</span><span class="n">j</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">rs</span><span class="p">[</span><span class="n">poslist</span><span class="p">]</span> <span class="o">=</span> <span class="n">rcur</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">frm_times</span><span class="p">[</span><span class="n">poslist</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">rcur</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">possible_evs</span><span class="p">[</span><span class="n">poslist</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    			
                        <span class="k">elif</span> <span class="ow">not</span> <span class="n">poss_now</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">possible_evs</span><span class="p">[</span><span class="n">poslist</span><span class="p">]:</span> <span class="c1"># if not possible now, but was possible before </span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">rs</span><span class="p">[</span><span class="n">poslist</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">frm_times</span><span class="p">[</span><span class="n">poslist</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tinfinity</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">possible_evs</span><span class="p">[</span><span class="n">poslist</span><span class="p">]</span> <span class="o">=</span><span class="kc">False</span>
 
                        <span class="k">elif</span> <span class="n">poss_now</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">possible_evs</span><span class="p">[</span><span class="n">poslist</span><span class="p">]</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastsel</span> <span class="ow">and</span> <span class="n">other</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastother</span><span class="p">:</span> 
                            <span class="n">rcur</span> <span class="o">=</span> <span class="n">get_r_func</span><span class="p">[</span><span class="n">j</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">rs</span><span class="p">[</span><span class="n">poslist</span><span class="p">]</span> <span class="o">=</span> <span class="n">rcur</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">frm_times</span><span class="p">[</span><span class="n">poslist</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">rcur</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">possible_evs</span><span class="p">[</span><span class="n">poslist</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    			
    
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">e</span><span class="o">.</span><span class="n">get_involve_other</span><span class="p">():</span> <span class="c1">#Ensure one time if neighbours are not effected by event</span>
                            <span class="k">break</span>           
 
        <span class="c1"># Update the first reaction part</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frm_arg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frm_times</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span></div>

<div class="viewcode-block" id="NeighborKMCBase.frm_step"><a class="viewcode-back" href="../../../api/NeighborKMC.base.html#NeighborKMC.base.kmc.NeighborKMCBase.frm_step">[docs]</a>    <span class="k">def</span> <span class="nf">frm_step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Takes a Monte Carlo Step.</span>
<span class="sd">        </span>
<span class="sd">        Takes a monte carlo step by performing the chronologically next</span>
<span class="sd">        possible event, which has index *self.frm_arg* in the   </span>
<span class="sd">        list self.frm_times.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        Warning:</span>
<span class="sd">            If an impossible event is attempted. Usually due to an infinite time-step.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Choose the first reaction if possible</span>
        <span class="n">site</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">siteslist</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frm_arg</span><span class="p">]</span>  <span class="c1"># The site to do event.</span>
        <span class="n">othersite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">other_sitelist</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frm_arg</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastsel</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">site</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastother</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">othersite</span><span class="p">)</span>
         
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">evs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frm_arg</span><span class="p">]]</span><span class="o">.</span><span class="n">possible</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="p">,</span>
                                                        <span class="n">site</span><span class="p">,</span> <span class="n">othersite</span><span class="p">):</span>
            <span class="c1"># Event is possible, change state</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">evs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frm_arg</span><span class="p">]]</span><span class="o">.</span><span class="n">do_event</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="p">,</span>
                                                         <span class="n">site</span><span class="p">,</span> <span class="n">othersite</span><span class="p">)</span>
            <span class="n">evtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frm_arg</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frm_times</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frm_arg</span><span class="p">]</span>  <span class="c1"># Update time</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">evs_exec</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">evs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frm_arg</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">stype_ev</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">sites</span><span class="p">[</span><span class="n">site</span><span class="p">]</span><span class="o">.</span><span class="n">stype</span><span class="p">]</span>\
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">evs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frm_arg</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">stype_ev_other</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">sites</span><span class="p">[</span><span class="n">othersite</span><span class="p">]</span><span class="o">.</span><span class="n">stype</span><span class="p">]</span>\
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">evs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frm_arg</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sid_ev</span><span class="p">[</span><span class="n">site</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">evs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frm_arg</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sid_ev_other</span><span class="p">[</span><span class="n">othersite</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">evs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frm_arg</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># New first reaction must be determined</span>
            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s2">&quot;Impossible event were next in que and was attempted&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frm_update</span><span class="p">()</span></div>


<div class="viewcode-block" id="NeighborKMCBase.load_events"><a class="viewcode-back" href="../../../api/NeighborKMC.base.html#NeighborKMC.base.kmc.NeighborKMCBase.load_events">[docs]</a>    <span class="k">def</span> <span class="nf">load_events</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Loads events (abstract method).</span>

<span class="sd">        This method must be overridden by the child class in user_kmc.NeighborKMC.</span>

<span class="sd">        Raises</span>
<span class="sd">        ---------</span>
<span class="sd">        NotImplementedError:</span>
<span class="sd">            If called.</span>
<span class="sd">          </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;User needs to define load_events</span>
<span class="s1">                                 method in derived NeighborKMC class&#39;&#39;&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="NeighborKMCBase.run_kmc"><a class="viewcode-back" href="../../../api/NeighborKMC.base.html#NeighborKMC.base.kmc.NeighborKMCBase.run_kmc">[docs]</a>    <span class="k">def</span> <span class="nf">run_kmc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Runs the kMC simulation (abstract method)</span>

<span class="sd">        This method must be overridden by the child class in user_kmc.NeighborKMC.</span>

<span class="sd">        Raises</span>
<span class="sd">        ---------</span>
<span class="sd">        NotImplementedError:</span>
<span class="sd">            If called.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;User needs to define run_kmc method </span>
<span class="s1">                                          in derived NeighborKMC class&#39;&#39;&#39;</span><span class="p">)</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019, Mikkel Jørgensen

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>